;;; flow3d_benchmarks.ops — TGV, ABC flow, 2D Burgers

include systems/flow3d_core.ops

;; ops.benchmarks.tgv: standard TGV velocity wavenumber 1
;; Checks: early-time energy decay, symmetry, divL2
voice init.tgv / { N + k_wavenumber -> generate.tgv.field -> project.divergence.free -> verify.symmetry -> verify.divL2 -> u_tgv }
voice check.tgv.energy.decay / { u_tgv + nu + k_wavenumber + time + energy_initial -> compute.expected.decay -> compute.actual.energy -> compare.decay.curves -> decay_check }

;; ops.benchmarks.abc: divergence-free init, advection fidelity
voice init.abc / { N + A + B + C -> generate.abc.field -> verify.divergence.free -> verify.advection.fidelity -> u_abc }

;; ops.benchmarks.burgers_2d: spectra and shock behavior sanity lane
voice init.burgers_2d / { N + initial_profile -> generate.burgers.2d.field -> u_burgers_2d }
voice simulate.burgers_2d / { u_initial + nu + dt -> compute.advection.2d -> compute.viscous.2d -> time.step -> check.shock.formation -> compute.spectrum.2d -> burgers_2d_results }

;; Validation matrix: A=baseline, B=+mask, C=+descent, D=both
voice config.A / { nu + k_f + mask_scheme "none" + descent_enabled false -> ⟨config_A⟩ }
voice config.B / { nu + k_f + mask_scheme + mask_params + descent_enabled false -> ⟨config_B⟩ }
voice config.C / { nu + k_f + mask_scheme "none" + descent_enabled true + eta + alpha -> ⟨config_C⟩ }
voice config.D / { nu + k_f + mask_scheme + mask_params + descent_enabled true + eta + alpha -> ⟨config_D⟩ }

;; Sweeps: nu ∈ {1e-2,1e-3}, k_f ∈ {2,4,8}, mask={off,coprime(p#=43)}, descent η∈{0,0.05}
voice sweep.parameters / { nu_values [1e-2, 1e-3] + k_f_values [2, 4, 8] + mask_options ["none", "coprime"] + descent_eta_values [0, 0.05] -> generate.parameter.matrix -> parameter_sweep }

;; Pass/flag: divergence threshold, energy drift, spectrum slope, reproducibility
voice check.invariants / { diagnostics + config -> check.divergence.threshold -> check.energy.drift -> check.spectrum.slope -> check.reproducibility -> invariants_passed }

target flow3d_benchmarks / "flow3d_benchmarks"
voice main / { init.tgv + init.abc + init.burgers_2d + check.invariants -> flow3d_benchmarks }
