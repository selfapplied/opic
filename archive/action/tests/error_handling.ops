;;; test_error_handling.ops â€” Test error conditions and edge cases

include core/bootstrap.ops

;; Test 1: Missing voice handling
voice test.error.missing_voice / {
  "nonexistent_voice" -> 
  handle_missing -> 
  "Missing voice: PASS"
}

voice handle_missing / {"nonexistent_voice" -> "handled"}

;; Test 2: Empty chain handling
voice test.error.empty_chain / {
  "" -> 
  handle_empty -> 
  "Empty chain: PASS"
}

voice handle_empty / {"" -> "handled"}

;; Test 3: Invalid input handling
voice test.error.invalid_input / {
  null -> 
  handle_invalid -> 
  "Invalid input: PASS"
}

voice handle_invalid / {null -> "handled"}

;; Test 4: Circular reference detection
voice test.error.circular_reference / {
  "circular" -> 
  detect_circular -> 
  "Circular detection: PASS"
}

voice detect_circular / {"circular" -> "detected"}

;; Test 5: Type mismatch handling
voice test.error.type_mismatch / {
  "string" + 123 -> 
  handle_mismatch -> 
  "Type mismatch: PASS"
}

voice handle_mismatch / {"string" + 123 -> "handled"}

;; Main test runner
voice test.error.all / {
  test.error.missing_voice -> 
  test.error.empty_chain -> 
  test.error.invalid_input -> 
  test.error.circular_reference -> 
  test.error.type_mismatch -> 
  "Error handling tests: PASS"
}

target test_error_handling / "error_handling_tests"
voice main / {test.error.all -> test_error_handling}

