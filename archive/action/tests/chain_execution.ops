;;; test_chain_execution.ops â€” Test chain execution correctness

include core/bootstrap.ops

;; Test 1: Simple chain execution order
voice test.chain.simple_order / {
  "input" -> 
  step1 -> 
  step2 -> 
  step3 -> 
  result
}

voice step1 / {"input" -> "step1_done"}
voice step2 / {"step1_done" -> "step2_done"}
voice step3 / {"step2_done" -> "step3_done"}
voice result / {"step3_done" -> "Chain execution: PASS"}

;; Test 2: Chain with branching
voice test.chain.branching / {
  "test" -> 
  branch_a -> 
  branch_b -> 
  merge -> 
  "Branching: PASS"
}

voice branch_a / {"test" -> "branch_a_result"}
voice branch_b / {"test" -> "branch_b_result"}
voice merge / {"branch_a_result" + "branch_b_result" -> "merged"}

;; Test 3: Nested chain execution
voice test.chain.nested / {
  "outer" -> 
  outer_step -> 
  nested_chain -> 
  "Nested: PASS"
}

voice outer_step / {"outer" -> "outer_done"}
voice nested_chain / {"outer_done" -> inner_step -> "nested_done"}
voice inner_step / {"outer_done" -> "inner_done"}

;; Test 4: Chain with environment passing
voice test.chain.environment / {
  "initial" -> 
  set_env -> 
  use_env -> 
  "Environment: PASS"
}

voice set_env / {"initial" -> env_value}
voice use_env / {env_value -> "used"}

;; Test 5: Chain termination
voice test.chain.termination / {
  "start" -> 
  process -> 
  "end" -> 
  "Termination: PASS"
}

voice process / {"start" -> "processed"}

;; Main test runner
voice test.chain.all / {
  test.chain.simple_order -> 
  test.chain.branching -> 
  test.chain.nested -> 
  test.chain.environment -> 
  test.chain.termination -> 
  "Chain execution tests: PASS"
}

target test_chain_execution / "chain_execution_tests"
voice main / {test.chain.all -> test_chain_execution}

