;;; integration.ops — Integration tests for system interactions

include core/bootstrap.ops

;; Test 1: Bootstrap → Load → Execute integration
voice test.integration.bootstrap_chain / {
  "test_file" -> 
  opic.load_bootstrap -> 
  opic.find_main -> 
  opic.execute_main -> 
  "Bootstrap chain: PASS"
}

;; Test 2: File discovery → Load → Execute integration
voice test.integration.file_discovery_chain / {
  "*.ops" -> 
  discover_files -> 
  load_file -> 
  execute_main -> 
  "File discovery chain: PASS"
}

voice discover_files / {"*.ops" -> "files_found"}
voice load_file / {"files_found" -> "file_loaded"}
voice execute_main / {"file_loaded" -> "executed"}

;; Test 3: Voice → Chain → Execution integration
voice test.integration.voice_chain_execution / {
  test_voice -> 
  execute_chain -> 
  "Voice chain: PASS"
}

voice test_voice / {"input" -> "output"}
voice execute_chain / {"input" -> test_voice -> "output"}

;; Test 4: Include → Parse → Load integration
voice test.integration.include_parse_load / {
  "include_file" -> 
  parse_include -> 
  load_included -> 
  "Include parse load: PASS"
}

voice parse_include / {"include_file" -> "parsed"}
voice load_included / {"parsed" -> "loaded"}

;; Test 5: Target → Voice → Output integration
voice test.integration.target_voice_output / {
  test_target -> 
  target_voice -> 
  "Target voice output: PASS"
}

target test_target / "test_output"
voice target_voice / {"input" -> test_target}

;; Main test runner
voice test.integration.all / {
  test.integration.bootstrap_chain -> 
  test.integration.file_discovery_chain -> 
  test.integration.voice_chain_execution -> 
  test.integration.include_parse_load -> 
  test.integration.target_voice_output -> 
  "Integration tests: PASS"
}

target test_integration / "integration_tests"
voice main / {test.integration.all -> test_integration}

