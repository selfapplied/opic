;;; gpqa_eval.ops â€” GPQA Diamond evaluation using opic's reasoning system (pure opic)

;; Load GPQA dataset
voice gpqa.load / {"data/benchmarks/gpqa.json" -> file_read -> json_decode}

;; Answer question using opic reasoning
voice gpqa.answer / {question + choices -> reason.answer -> answer_index}

;; Check if answer is correct
voice gpqa.check / {answer_index + correct_answer -> equals -> is_correct}

;; Evaluate one question
voice gpqa.eval_one / {
  question + choices + correct_answer -> 
  gpqa.answer -> 
  gpqa.check -> 
  score
}

;; Evaluate all questions (GPQA Diamond is small, use all)
voice gpqa.evaluate_all / {
  gpqa_data -> 
  map_evaluate -> 
  count_correct -> 
  calculate_percentage -> 
  gpqa_score
}

;; Main GPQA evaluation
voice gpqa.evaluate / {
  gpqa.load -> 
  gpqa.evaluate_all -> 
  results
}

target gpqa_eval / "gpqa_evaluation"
voice main / {gpqa.evaluate -> gpqa_eval}

