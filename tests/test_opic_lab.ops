;;; test_opic_lab.ops â€” OPIC Lab Test Suite (.ops)

include systems/opic_mode7_lab.ops

;; Test router decision
voice test.router.decision / {
  budget + health + last_metrics -> 
  policy.router -> 
  check.decision.valid -> 
  router_test_result
}

;; Test health guards
voice test.health.guards / {
  divL2 + parseval -> 
  guard.hygiene -> 
  check.circuit.breaker -> 
  health_test_result
}

;; Test fusion detection
voice test.fusion.detection / {
  significant_shells + delta_mi + decode_improved -> 
  detect.fusion.moment -> 
  check.fusion.valid -> 
  fusion_test_result
}

;; Test phase flux
voice test.phase.flux / {
  theta + time -> 
  compute.angular.velocity -> 
  compute.phase.flux -> 
  check.phase.valid -> 
  phase_flux_test_result
}

;; Test coherence
voice test.coherence / {
  angular_velocities + ratios -> 
  detect.coherent.dance -> 
  check.coherence.valid -> 
  coherence_test_result
}

;; Run all tests
voice run.all.tests / {
  test.router.decision -> 
  test.health.guards -> 
  test.fusion.detection -> 
  test.phase.flux -> 
  test.coherence -> 
  all_test_results
}

target test_opic_lab / "test_opic_lab"
voice main / { run.all.tests -> test_opic_lab }

