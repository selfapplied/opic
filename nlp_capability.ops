;;; nlp_capability.ops â€” NLP capability layer for semantic understanding

include bootstrap.ops

;; NLP capability definitions
def capability_description { operation, path, agent, description, classification, tags, semantic_summary }
def semantic_tags { realm, purpose, ethical_weight, coherence_level, category }
def coherence_score { linguistic_coherence, semantic_coherence, ethical_alignment, resonance_alignment }

;; Describe capability (generates human-readable summary)
voice nlp.describe_capability / {operation + path + agent + context -> nlp.analyze_intent -> nlp.generate_summary -> capability_description}
voice nlp.analyze_intent / {operation + path + agent -> nlp.extract_patterns -> nlp.infer_purpose -> intent}
voice nlp.extract_patterns / {operation + path -> analyze_structure -> patterns}
voice analyze_structure / {path -> parse_path -> extract_keywords -> keywords}
voice nlp.infer_purpose / {operation + keywords + agent -> match_patterns -> purpose}
voice nlp.generate_summary / {intent + purpose + context -> nlp.format_description -> description}
voice nlp.format_description / {intent + purpose -> create_natural_language -> text}

;; Tag semantics (extracts realm, purpose, ethical weight)
voice nlp.tag_semantics / {capability_description -> nlp.extract_realm + nlp.extract_purpose + nlp.extract_ethical_weight + nlp.classify -> semantic_tags}
voice nlp.extract_realm / {description + agent -> parse_realm -> realm}
voice parse_realm / {agent -> extract_realm_name -> realm}
voice nlp.extract_purpose / {description + operation -> infer_purpose -> purpose}
voice infer_purpose / {description -> match_purpose_patterns -> purpose}
voice nlp.extract_ethical_weight / {description + operation -> compute_ethical_weight -> weight}
voice compute_ethical_weight / {description -> analyze_impact -> weight}
voice nlp.classify / {description + operation -> classify_category -> category}
voice classify_category / {description -> match_categories -> category}

;; Score coherence (rates linguistic/semantic coherence)
voice nlp.score_coherence / {capability_description + semantic_tags -> nlp.linguistic_coherence + nlp.semantic_coherence + nlp.ethical_alignment -> coherence_score}
voice nlp.linguistic_coherence / {description -> analyze_language_quality -> linguistic_score}
voice analyze_language_quality / {text -> check_clarity + check_completeness -> quality}
voice nlp.semantic_coherence / {description + tags -> check_semantic_consistency -> semantic_score}
voice check_semantic_consistency / {description + tags -> verify_alignment -> consistency}
voice nlp.ethical_alignment / {description + ethical_weight -> check_ethical_coherence -> ethical_score}
voice check_ethical_coherence / {description + weight -> verify_alignment -> alignment}

;; Generate concise summary (for certificates)
voice nlp.generate_summary / {operation + path + agent + context -> nlp.describe_capability -> nlp.extract_key_points -> summary}
voice nlp.extract_key_points / {description -> extract_main_points -> key_points}
voice extract_main_points / {text -> identify_key_phrases -> points}

;; Classification categories
voice nlp.classify_education / {description -> match_education_patterns -> is_education}
voice nlp.classify_governance / {description -> match_governance_patterns -> is_governance}
voice nlp.classify_code / {description -> match_code_patterns -> is_code}
voice nlp.classify_art / {description -> match_art_patterns -> is_art}
voice nlp.classify_ethics / {description -> match_ethics_patterns -> is_ethics}

;; Pattern matching (lightweight, rule-based)
voice match_education_patterns / {text -> contains "education" + contains "learn" + contains "teach" -> matches}
voice match_governance_patterns / {text -> contains "governance" + contains "policy" + contains "rule" -> matches}
voice match_code_patterns / {text -> contains "code" + contains "implement" + contains "function" -> matches}
voice match_art_patterns / {text -> contains "art" + contains "create" + contains "express" -> matches}
voice match_ethics_patterns / {text -> contains "ethics" + contains "resonance" + contains "coherence" -> matches}

;; Realm voice learning (reflective NLP)
voice nlp.learn_realm_voice / {descriptions + realm -> nlp.extract_style + nlp.build_voice_model -> realm_voice}
voice nlp.extract_style / {descriptions -> analyze_tone + analyze_vocabulary -> style}
voice analyze_tone / {texts -> extract_tone_patterns -> tone}
voice analyze_vocabulary / {texts -> extract_common_words -> vocabulary}
voice nlp.build_voice_model / {style + vocabulary -> create_model -> voice_model}

;; Refine description using realm voice
voice nlp.refine_with_voice / {description + realm_voice -> nlp.apply_voice -> refined_description}
voice nlp.apply_voice / {description + voice_model -> adjust_tone + adjust_vocabulary -> refined}

;; External LLM integration (optional, for offline summarization)
voice nlp.llm_summarize / {operation + path + agent + context -> nlp.call_llm_api -> nlp.store_locally -> summary}
voice nlp.call_llm_api / {context -> api_request -> llm_response}
voice nlp.store_locally / {summary -> store_in_cache -> cached}

;; Complete NLP pipeline
voice nlp.process_capability / {operation + path + agent + context -> nlp.describe_capability -> nlp.tag_semantics -> nlp.score_coherence -> nlp_result}
voice nlp_result / {description + tags + coherence -> complete_nlp_data}

target nlp_capability / "nlp_capability_layer"
voice main / {nlp.process_capability -> nlp_capability}

